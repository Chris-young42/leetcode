/**
 * @param {number[]} nums - 输入的数组，长度为 n，包含 n+1 个整数，数字范围是 [1, n]
 *                          根据题意：数组中**只有一个重复的数字**，要找到它。
 * @return {number} - 返回数组中重复的那个数字
 */
var findDuplicate = function(nums) {
    const n = nums.length; // 数组长度
    let l = 1, r = n - 1;  // 数字范围是 [1, n-1]，因为数组中 n 个数取值范围是 [1, n-1]
    let ans = -1;          // 最终答案（初始化为 -1）

    // 使用二分查找法（不是在数组上二分，而是在「数值范围」上二分）
    while (l <= r) {
        let mid = (l + r) >> 1; // 中间值（右移 1 位相当于除以 2，取整）

        // 统计数组中 ≤ mid 的元素个数
        let cnt = 0;
        for (let i = 0; i < n; ++i) {
            // 如果当前数字 ≤ mid，就让计数器加一
            cnt += nums[i] <= mid;
        }

        /**
         * 理解关键点 👇：
         * 在一个没有重复数字的情况下，
         * 值 ≤ mid 的数字个数应该最多是 mid 个。
         * 例如：
         *   数组 [1,2,3,4,5]，mid=3 时，≤3 的数字有 3 个。
         * 但如果出现重复，比如 [1,3,4,2,2]，
         *   mid=2 时，≤2 的数字有 3 个（1,2,2），比 2 多。
         * 所以：cnt > mid 说明「重复的数在 [1, mid]」之间。
         */

        if (cnt <= mid) {
            // 如果 ≤ mid 的个数不超过 mid，说明重复数在右半区间
            l = mid + 1;
        } else {
            // 否则重复数在左半区间（包含 mid）
            r = mid - 1;
            ans = mid; // 暂时记录答案（mid 可能就是重复数）
        }
    }

    // 返回最终的重复数
    return ans;
};
